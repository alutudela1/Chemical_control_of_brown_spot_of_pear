---
title: "Susceptibility of Stemphylium vesicarium strains to different fungicides"
author: "Marisa A.A. Tudela"
date: "2023-03-01"
output:
  pdf_document: default
  html_document: default
---

# Inhibition of mycelial growth of S. vesicarium in vitro

```{r}
pacman::p_load(tidyverse, drc, ec50estimator, ggridges)
```


```{r error=TRUE, eval=TRUE}
dat<- read.table("mycelial growth.csv", sep = ";", header = TRUE, dec=",")
str(dat)
dat$Concentration.ppm<- as.numeric(dat$Concentration.ppm)
dat$CD<- as.numeric(dat$CD)
dat$Day<- as.factor(dat$Day)
dat$Strain<- as.factor(dat$Strain)

```
## Bellis

**Strain s23**
```{r warning=FALSE, error=FALSE}
S23B<- dat %>% 
 filter(Strain=="S23", Treatment=="Bellis")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S23Bellis<- drm(CD~ Concentration.ppm, data = S23B, 
                            fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S23Bellis)
ED(model.LL3_S23Bellis, respLev = c(50), interval="delta", type = "relative")


```
**Strain s20**
```{r warning=FALSE}
S20B<- dat%>% 
  filter(Strain=="S20", Treatment=="Bellis")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S20Bellis<- drm(CD~ Concentration.ppm, data = S20B, 
                            fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S20Bellis)
ED(model.LL3_S20Bellis, respLev = c(50), interval="delta", type = "relative")

```
**Strain s8**
```{r warning=FALSE}
S8B<- dat %>% 
  filter(Strain=="S8", Treatment=="Bellis")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S8Bellis<- drm(CD ~ Concentration.ppm, data = S8B, 
                           fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S8Bellis)
ED(model.LL3_S8Bellis, respLev = c(50), interval="delta", type = "relative")

```

**Differences between strains**
```{r warning=FALSE}
dat_cd<- dat %>%
  filter(Treatment=="Bellis") 
dat_cd %>% janitor::tabyl(Strain, Concentration.ppm)
mod_bellis_cd<- drm(CD ~ Concentration.ppm,   
                       curveid = Strain, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                       data = dat_cd)

summary(mod_bellis_cd)
plot(mod_bellis_cd)
EDcomp(mod_bellis_cd, c(50,50))

```

## Merpan

**Strain s23**
```{r}
S23M<- dat %>% 
  filter(Strain=="S23", Treatment=="Merpan")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S23M <- drm(CD~ Concentration.ppm, data = S23M, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S23M)
ED(model.LL3_S23M, respLev = c(50), interval="delta", type = "relative")

```


**Strain S20**
```{r}
S20M<- dat%>% 
  filter(Strain=="S20", Treatment=="Merpan")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S20M<- drm(CD~ Concentration.ppm, data = S20M, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S20M)
ED(model.LL3_S20M, respLev = c(50), interval="delta", type = "relative")

```


**Strain s8**
```{r}
S8M<- dat%>% 
 filter(Strain=="S8", Treatment=="Merpan")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S8M<- drm(CD~ Concentration.ppm, data = S8M, 
                      fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S8M)
ED(model.LL3_S8M, respLev = c(50), interval="delta", type = "relative")

```


**Differences between strains**
```{r warning=FALSE}
 data_cdm <- dat %>%
  filter(Treatment=="Merpan") 
data_cdm %>% janitor::tabyl(Strain, Concentration.ppm)
mod_merpan_cd <- drm(CD ~ Concentration.ppm,   
                       curveid = Strain, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                       data = data_cdm)
summary(mod_merpan_cd)
plot(mod_merpan_cd)
EDcomp(mod_merpan_cd, c(50,50))

```


## Timorex 

**Strain S23**
```{r}
S23T<- dat %>% 
  filter(Strain=="S23", Treatment=="Timorex")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S23T<- drm(CD~ Concentration.ppm, data = S23T, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S23T)
ED(model.LL3_S23T, respLev = c(50), interval="delta", type = "relative")

```
**Strain S20**
```{r}
S20T<- dat%>% 
  filter(Strain=="S20", Treatment=="Timorex")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S20T <- drm(CD~ Concentration.ppm, data = S20T, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S20T)
ED(model.LL3_S20T, respLev = c(50), interval="delta", type = "relative")

```
**Strain s8**
```{r}
S8T<- dat%>% 
  filter(Strain=="S8", Treatment=="Timorex")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S8T <- drm(CD~ Concentration.ppm, data = S8T, 
                      fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S8T)
ED(model.LL3_S8T, respLev = c(50), interval="delta", type = "relative")

```
**Differences between strains**
```{r warning=FALSE}
data_cdT<- dat %>%
  filter(Treatment=="Timorex") 
data_cdT %>% janitor::tabyl(Strain, Concentration.ppm)
mod_tim_cd <- drm(CD ~ Concentration.ppm,   
                       curveid = Strain, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                       data = data_cdT)
summary(mod_tim_cd)
plot(mod_tim_cd)
EDcomp(mod_tim_cd, c(50,50))

```

## Ziram

**Strain s23**
```{r}
S23Z<- dat%>% 
  filter(Strain=="S23", Treatment=="Ziram")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S23Z<- drm(CD~ Concentration.ppm, data = S23Z, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S23Z)
ED(model.LL3_S23Z, respLev = c(50), interval="delta", type = "relative")

```
**Strain s20**
```{r}
S20Z<- dat%>% 
  filter(Strain=="S20", Treatment=="Ziram")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S20Z <- drm(CD~ Concentration.ppm, data = S20Z, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S20Z)
ED(model.LL3_S20Z, respLev = c(50), interval="delta", type = "relative")

```
**Strain s8**
```{r}
S8Z<- dat%>% 
  filter(Strain=="S8", Treatment=="Ziram")%>% 
  mutate(dose_decimal = format(Concentration.ppm, scientific = FALSE))
model.LL3_S8Z <- drm(CD~ Concentration.ppm, data = S8Z, 
                      fct = LL.3(names = c("Slope", "Upper Limit", "ED50")))
plot(model.LL3_S8Z)
ED(model.LL3_S8Z, respLev = c(50), interval="delta", type = "relative")

```
**Differences between strains**
```{r warning=FALSE}
data_cdz<- dat%>%
  filter(Treatment=="Ziram") 
data_cdz %>% janitor::tabyl(Strain, Concentration.ppm)
mod_ziram_cd <- drm(CD ~ Concentration.ppm,   
                       curveid = Strain, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                       data = data_cdz)
summary(mod_ziram_cd)
plot(mod_ziram_cd)
EDcomp(mod_ziram_cd, c(50,50))

```
# General Analysis
```{r}
dat_treatment <- dat%>% 
  filter(Day=="7") 
dat_treatment%>% janitor::tabyl(Treatment, Concentration.ppm)
mod_treatment<- drm(CD ~ Concentration.ppm,   
                 curveid = Treatment, 
                 fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                 data = dat)
summary(mod_treatment)
plot(mod_treatment, xlab = "Concentration ( μg mL-1)", ylab = "Colony diameter (mm)",broken = TRUE, cex.lab=1.5,cex.legend = 1.2,lty=1, lwd=2)
EDcomp(mod_treatment, c(50,50))

```

# Inhibition of spore germination of S. vesicarium in vitro 

```{r}
germigraf<- read.table("germination.csv", sep = ";", header = TRUE, dec=",")
germigraf$Concentration.ppm.<- as.numeric(germigraf$Concentration.ppm.)
germigraf$Repetition<- as.factor(germigraf$Repetition)
germigraf$Replicate<- as.factor(germigraf$Replicate)
germigraf %>% str
ftable(xtabs(complete.cases(Germination.percentage)~Treatment+ Concentration.ppm. , data=germigraf))
ftable(xtabs(complete.cases(Germination.percentage)~Treatment+ Concentration.ppm.+ Strain , data=germigraf))

```
## Bellis
```{r}
dat_convGB <- germigraf %>%
  filter(Treatment=="Bellis") 
dat_convGB %>% janitor::tabyl(Strain, Concentration.ppm.)
mod_fungiGB <- drm(Germination.percentage ~ Concentration.ppm.,   
                   curveid = Strain, 
                   fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                   data = dat_convGB)
summary(mod_fungiGB)
plot(mod_fungiGB)
EDcomp(mod_fungiGB, c(50,50))

```
## Merpan
```{r}
dat_convGC <- germigraf %>%
  filter(Treatment=="Merpan") 
dat_convGC %>% janitor::tabyl(Strain, Concentration.ppm.)
mod_fungiGC <- drm(Germination.percentage ~ Concentration.ppm.,   
                   curveid = Strain, 
                   fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                   data = dat_convGC)
summary(mod_fungiGC)
plot(mod_fungiGC)
EDcomp(mod_fungiGC, c(50,50))

```
## Timorex
```{r}
dat_convGT <- germigraf %>%
  filter(Treatment=="Timorex") 
dat_convGT %>% janitor::tabyl(Strain, Concentration.ppm.)
mod_fungiGT <- drm(Germination.percentage ~ Concentration.ppm.,   
                   curveid = Strain, 
                   fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                   data = dat_convGT)
summary(mod_fungiGT)
plot(mod_fungiGT)
EDcomp(mod_fungiGT, c(50,50))

```
## Ziram
```{r}
dat_convGZ <- germigraf %>%
  filter(Treatment=="Ziram") 
dat_convGZ %>% janitor::tabyl(Strain, Concentration.ppm.)
mod_fungiGZ <- drm(Germination.percentage ~ Concentration.ppm.,   
                   curveid = Strain, 
                   fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                   data = dat_convGZ)
summary(mod_fungiGZ)
plot(mod_fungiGZ)
EDcomp(mod_fungiGZ, c(50,50))
```
## General Analysis 
```{r}
mod_germigergra <- drm(Germination.percentage ~ Concentration.ppm.,   
                       curveid = Treatment, 
                       fct = LL.3(names = c("Slope", "Upper Limit", "ED50")), 
                       data = germigraf)
summary(mod_germigergra)
plot(mod_germigergra, xlab="Concentration (µg mL-1) ", ylab="Germination (%)",cex.lab=1.5,cex.legend = 1.2, lty=1, lwd=2)
ED(mod_germigergra, respLev = c(50), interval="delta", type = "relative")
EDcomp(mod_germigergra, c(50,50))


```

# Bioassays in fruits

## Preventive treatments: Disease severity analysis (spots per fruit) 

```{r}
sev_prev<-read.table("preventive treatments.csv", sep=";", header=TRUE, dec=",")
sev_prev$Day<- as.factor(sev_prev$Day)
sev_prev$Repetition<- as.factor(sev_prev$Repetition)
sev_prev$Replicate<- as.factor(sev_prev$Replicate)
str(sev_prev)
glimpse(sev_prev)

```
```{r warning=FALSE}
sev_prev %>% ggplot() + aes(x=Treatment, y = spots_per_fruit) + geom_boxplot() +  geom_boxplot(alpha=.5, width = .2) + geom_jitter(col=2) + geom_point(alpha=.7) + labs(x="Treatment", y="Incidence (spots per fruit)")
sev_prev %>% ggplot() + aes(x=Treatment, y = spots_per_fruit) + geom_boxplot(alpha=.5, width = .2) + geom_point(alpha=.7) + labs(x="Treatments", y="Severity)")
plot(sev_prev$spots_per_fruit,method="stack", vertical=TRUE, pch=0, main="Dot plot", ylab="Spots per fruit", col="black")
ggplot(sev_prev,aes(x=Treatment, y=spots_per_fruit, fill=Treatment))+geom_bar(stat="identity")+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
a<- ggplot(sev_prev,aes(x=Treatment, y=spots_per_fruit, fill=Treatment))+geom_bar(stat="identity")+ facet_grid(.~Day)
g_a <- a + scale_fill_grey()  
g_a
```
```{r message=FALSE}
library(car)
library(DAAG)
library(effects)
library(Epi)
library(MASS)
library(faraway)
library(nnet)
library(nlme)
library(lmtest)
library(zoo)
library(ResourceSelection)
library(ggplot2)
library(ordinal)
library(lme4)
library(emmeans)
library(multcomp)
library(GGally)
library(ggeffects)
library(ggpubr)
library(tidyverse)
library(nlme)
library(multcompView)


```

```{r}
mod_gls3 <- gls(s.r.spots~1+Treatment+Day+Treatment:Day,weights=varComb(varIdent(form=~1|Treatment*Day)),method="REML",na.action=na.omit,data=sev_prev)
summary(mod_gls3)
car::Anova(mod_gls3, type="III")
sum(residuals(mod_gls3, type="pearson")^2)
pchisq(585, 585, lower.tail = F)

```

```{r}
mediasml2 = emmeans(mod_gls3, ~ Treatment*Day) 
pairs(mediasml2, adjust= "Tukey")
glsinc = cld(mediasml2, alpha=0.05, Letters=letters, adjust= "Tukey")
glsinc
glsinc1 = as.tibble(glsinc)
pd  <- position_dodge(0.9) 
ggplot(glsinc1, aes(x = Treatment, y = emmean, fill= Treatment)) +
  facet_wrap(~Day) + geom_col(position ="dodge")  + 
  geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), 
                colour = "black", width=0.4, position = pd) + 
  geom_point(position=pd, size=3,  col = "blue")+ 
  geom_text(aes(label = .group, y = emmean + SE),position=pd, hjust = -0.01) + 
  ylab("Spots per fruit emmeans")
glsimedia2022  <- emmeans(mod_gls3, ~ Treatment*Day, by = "Day")
pairs(glsimedia2022 , adjust= "Tukey", type="response")
medias_conjunto = cld(glsimedia2022, alpha=0.05, Letters=letters, adjust= "Tukey")
medias_conjunto
anidado_prev = as.tibble(medias_conjunto)
pd  <- position_dodge(0.9) 
ggplot(anidado_prev, aes(x = Treatment, y = emmean, fill= Treatment)) + facet_wrap(~Day) + geom_col(position = "dodge")  + geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), colour = "black", width=0.1, position = pd) + geom_point(position=pd, size=3,  col = "blue")+ geom_text(aes(label = .group, y = emmean + SE),position=pd, hjust = -0.4) + ylab("Spots per fruit emmeans")
```


## Preventive treatments, disease incidence analysis (proportion of affected fruit) 

**Bellis day 1- Bellis day 7:** 
```{r}
prop.test(c(5,30),n=c(40,40))
```
**Bellis day 1 – Merpan day 1:**
```{r}
prop.test(c(5,18),n=c(40,40)) 
```
**Bellis day 1 – Ziram day 1:**
```{r}
prop.test(c(5,25),n=c(40,40))
```

**Ziram day 7 – Ziram 15:**
```{r}
prop.test(c(25,40),n=c(40,40))
```
**Ziram day 1 – Merpan day 1:**
```{r}
prop.test(c(25,18),n=c(40,40))

```

## Curative treatments: Disease severity analysis (spots per fruit) 

```{r}
curativopaper<-read.table("curative treatments.csv", sep=";", header=TRUE, dec=",")
curativopaper$Repetition<- as.factor(curativopaper$Repetition)
curativopaper$Replicate<- as.factor(curativopaper$Replicate)
str(curativopaper)

```
```{r warning=FALSE}
plot(curativopaper$spots.per.fruit,method="stack", vertical=TRUE, pch=0, main="Dot plot", ylab="Spots per fruit", col="black")
ggboxplot(curativopaper, y= "spots.per.fruit", x = c("Treatment."), 
          merge = TRUE, color="Treatment.", pallete="jco")
ggplot(curativopaper,aes(x=Treatment., y=spots.per.fruit, fill=Treatment.))+geom_bar(stat="identity")+theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1))
```
```{r warning=FALSE}
m_REML<- gls(r.s.spots ~1+Treatment.,weights=varComb(varIdent(form=~1|Treatment.)),method="REML",na.action=na.omit,data=curativopaper)
summary(m_REML)
performance::check_homogeneity(m_REML)
sum(residuals(m_REML, type="pearson")^2)
pchisq(195, 195, lower.tail = F)
Anova(m_REML, type="II")
mediasmd1 = emmeans(m_REML, ~ Treatment.)
pairs(mediasmd1, adjust= "Tukey")
cld(mediasmd1, alpha=0.05, Letters=letters, adjust= "Tukey")
mediasd1 = cld(mediasmd1, alpha=0.05, Letters=letters, adjust= "Tukey")
tablamedia = as.tibble(mediasd1)
pd  <- position_dodge(0.9) 
ggplot(tablamedia, aes(x = Treatment., y = emmean, fill= Treatment.)) + geom_col(position = "dodge")  + geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), colour = "black", width=0.1, position = pd) + geom_point(position=pd, size=3,  col = "blue")+ geom_text(aes(label = .group, y = emmean + SE),position=pd, hjust = -0.01) + ylab("spots per fruit emmeans")
g_d1 <-ggplot(tablamedia, aes(x=reorder(Treatment.,-emmean), y=emmean, fill=Treatment.)) + geom_col(position = "dodge")  + geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), colour = "black", width=0.1, position = pd) + geom_point(position=pd, size=3,  col = "blue")+ geom_text(aes(label = .group, y = emmean + SE),position=pd, hjust = -0.4) + ylab("Spots per fruit emmeans")
g_d1a <- g_d1 + scale_fill_grey()
g_d1a

```

## Curative treatments, disease incidence analysis (proportionality test).

**Bellis vs Control**
```{r warning=FALSE}
prop.test(c(18,20),n=c(20,20))
```
**Ziram vs Control**
```{r warning=FALSE}
prop.test(c(19,20),n=c(20,20))
```
**Merpan vs Bellis**
```{r warning=FALSE}
prop.test(c(19,18),n=c(20,20))
```
# In-field assays

```{r}
campo<-read.csv2("Field treatments.csv")
head(campo)
str(campo)
campo$Season<-as.factor(campo$Season)
library(betareg)
mod_campo_beta = betareg(prop1 ~ Treatment*Season, data =campo)
car::Anova(mod_campo_beta)
plot(mod_campo_beta)
betacampomedia2022 <- emmeans(mod_campo_beta, ~ Treatment*Season,
                              by = "Season")
pairs(betacampomedia2022 , adjust= "Tukey", type="response")
library(multcomp)
cld(betacampomedia2022, alpha=0.05, Letters=letters, adjust= "Tukey")
pwpp(betacampomedia2022)
medias_campo = cld(betacampomedia2022, alpha=0.05, Letters=letters, adjust= "Tukey")
medias_campo
anidado_campo = as.tibble(medias_campo)
pd  <- position_dodge(0.9) 
ggplot(anidado_campo, aes(x = Treatment, y = emmean, fill= Treatment)) + facet_wrap(~Season) + geom_col(position = "dodge")  + geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), colour = "black", width=0.1, position = pd) + geom_point(position=pd, size=3,  col = "blue")+ geom_text(aes(label = .group, y = emmean + SE),position=pd, hjust = -0.4) + ylab("Incidence emmeans")
g_ordc <-ggplot(anidado_campo, aes(x=reorder(Treatment,-emmean), y=emmean, fill=Treatment))+ facet_wrap(~Season) + geom_col(position = "dodge")  + geom_errorbar(aes(ymin = emmean - SE, ymax = emmean + SE), colour = "black", width=0.1, position = pd) + geom_point(position=pd, size=3,  aes( col = Season))+ geom_text(aes(label = .group, y = emmean + SE),position=pd, hjust = -0.4) + ylab("Proportion of affected leaves") + xlab("Treatment")
g_ordc2 <- g_ordc + scale_fill_grey()  
g_ordc2


```

